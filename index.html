
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sign Language to Text</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h1 {
      font-size: 1.8em;
      margin-top: 20px;
    }

    #webcam {
      margin-top: 20px;
      border: 2px solid #ccc;
      width: 90vw;
      max-width: 640px;
      height: auto;
      aspect-ratio: 4 / 3;
    }

    #output {
      font-size: 1.5em;
      margin: 20px auto;
      color: #00ff90;
      max-width: 90vw;
      word-wrap: break-word;
    }

    @media (min-width: 768px) {
      h1 {
        font-size: 2.2em;
      }

      #output {
        font-size: 2em;
      }
    }
  </style>
</head>
<body>
  <h1>Sign Language to Text</h1>
  <video id="webcam" autoplay playsinline></video>
  <div id="output">Loading model...</div>

  <!-- TensorFlow.js and Handpose -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.20.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>

  <!-- Fingerpose -->
  <script src="https://cdn.jsdelivr.net/npm/fingerpose@0.1.0/dist/fingerpose.min.js"></script>

  <!-- Gesture Definitions -->
  <script>
    const { GestureDescription, Finger, FingerCurl, FingerDirection } = window.fp;

    function defineWordGestures() {
      const gestures = [];

      // HELLO - flat hand (all fingers extended, vertical up)
      const Hello = new GestureDescription("Hello");
      for (let finger of Finger.all) {
        Hello.addCurl(finger, FingerCurl.NoCurl, 1.0);
        Hello.addDirection(finger, FingerDirection.VerticalUp, 1.0);
      }
      gestures.push(Hello);

      // YES - fist (same as 'A')
      const Yes = new GestureDescription("Yes");
      for (let finger of Finger.all) {
        Yes.addCurl(finger, FingerCurl.FullCurl, 1.0);
      }
      gestures.push(Yes);

      // NO - index and middle extended
      const No = new GestureDescription("No");
      No.addCurl(Finger.Index, FingerCurl.NoCurl);
      No.addCurl(Finger.Middle, FingerCurl.NoCurl);
      for (let finger of [Finger.Ring, Finger.Pinky, Finger.Thumb]) {
        No.addCurl(finger, FingerCurl.FullCurl);
      }
      gestures.push(No);

      // THANKS - flat hand, palm out
      const Thanks = new GestureDescription("Thanks");
      for (let finger of Finger.all) {
        Thanks.addCurl(finger, FingerCurl.NoCurl);
        Thanks.addDirection(finger, FingerDirection.DiagonalUpLeft, 0.75);
        Thanks.addDirection(finger, FingerDirection.DiagonalUpRight, 0.75);
      }
      gestures.push(Thanks);

      // PLEASE - flat hand, palm on chest (approx.)
      const Please = new GestureDescription("Please");
      for (let finger of Finger.all) {
        Please.addCurl(finger, FingerCurl.NoCurl);
        Please.addDirection(finger, FingerDirection.VerticalUp);
      }
      gestures.push(Please);

      // STOP - palm outward (same as Hello, held outward)
      const Stop = new GestureDescription("Stop");
      for (let finger of Finger.all) {
        Stop.addCurl(finger, FingerCurl.NoCurl);
        Stop.addDirection(finger, FingerDirection.VerticalUp);
      }
      gestures.push(Stop);

      // LOVE - "I love you" sign (index, pinky, and thumb out)
      const Love = new GestureDescription("Love");
      Love.addCurl(Finger.Index, FingerCurl.NoCurl);
      Love.addCurl(Finger.Pinky, FingerCurl.NoCurl);
      Love.addCurl(Finger.Thumb, FingerCurl.NoCurl);
      Love.addCurl(Finger.Middle, FingerCurl.FullCurl);
      Love.addCurl(Finger.Ring, FingerCurl.FullCurl);
      gestures.push(Love);

      // HELP - thumb up, other fingers curled
      const Help = new GestureDescription("Help");
      Help.addCurl(Finger.Thumb, FingerCurl.NoCurl);
      for (let finger of [Finger.Index, Finger.Middle, Finger.Ring, Finger.Pinky]) {
        Help.addCurl(finger, FingerCurl.FullCurl);
      }
      gestures.push(Help);

      // FINE - thumb touching chest, others up (simplified)
      const Fine = new GestureDescription("Fine");
      Fine.addCurl(Finger.Thumb, FingerCurl.NoCurl);
      for (let finger of [Finger.Index, Finger.Middle, Finger.Ring, Finger.Pinky]) {
        Fine.addCurl(finger, FingerCurl.NoCurl);
        Fine.addDirection(finger, FingerDirection.VerticalUp);
      }
      gestures.push(Fine);

      // GOOD - flat hand to mouth (approx.)
      const Good = new GestureDescription("Good");
      for (let finger of Finger.all) {
        Good.addCurl(finger, FingerCurl.NoCurl);
        Good.addDirection(finger, FingerDirection.DiagonalUpLeft, 0.75);
        Good.addDirection(finger, FingerDirection.DiagonalUpRight, 0.75);
      }
      gestures.push(Good);

      return gestures;
    }
  </script>

  <!-- Main App -->
  <script>
    const video = document.getElementById('webcam');
    const output = document.getElementById('output');

    async function setupCamera() {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "user" }
      });
      video.srcObject = stream;
      return new Promise(resolve => {
        video.onloadedmetadata = () => resolve(video);
      });
    }

    async function main() {
      await setupCamera();
      await tf.setBackend('webgl');
      await tf.ready();

      const model = await handpose.load();
      output.innerText = 'Model Ready';

      const gestures = defineWordGestures();
      const gestureEstimator = new fp.GestureEstimator(gestures);

      setInterval(async () => {
        const predictions = await model.estimateHands(video);
        if (predictions.length > 0) {
          const estimated = await gestureEstimator.estimate(predictions[0].landmarks, 7.5);
          if (estimated.gestures.length > 0) {
            const best = estimated.gestures.reduce((p, c) => (p.score > c.score ? p : c));
            output.innerText = `Detected: ${best.name}`;
          } else {
            output.innerText = 'No gesture detected';
          }
        } else {
          output.innerText = 'No hand detected';
        }
      }, 150);
    }

    main();
  </script>
</body>
</html>
